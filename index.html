<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Teacher Data (This Month)</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #74ABE2, #5563DE);
    color: white;
    text-align: center;
    padding: 30px;
  }
  h1 {
    font-size: 1.8em;
  }
  table {
    width: 90%;
    max-width: 700px;
    margin: 20px auto;
    border-collapse: collapse;
    background: white;
    color: black;
    border-radius: 10px;
    overflow: hidden;
  }
  th, td {
    padding: 10px;
    border-bottom: 1px solid #ddd;
  }
  th {
    background: #5563DE;
    color: white;
  }
</style>
</head>
<body>

<h1>Teacher Data (This Month)</h1>
<p id="rangeInfo">Loading...</p>

<h2>Full Records</h2>
<table id="dataTable">
  <thead>
    <tr><th>Date</th><th>Teacher Name</th></tr>
  </thead>
  <tbody></tbody>
</table>

<h2>Summary (Count per Teacher)</h2>
<table id="summaryTable">
  <thead>
    <tr><th>Teacher</th><th>Count</th></tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRgjGiwz_YAGf5XkE77TTP5BydKRO_Dp1I95wRFkUGS4M36kX1hpQWotXy5NHi7yg5HkWDpUDufZK2p/pub?output=csv";

async function loadCSV() {
  try {
    const response = await fetch(csvUrl);
    const text = await response.text();
    const rows = text.trim().split("\n").map(r => r.split(","));
    
    const now = new Date();
    const year = now.getFullYear();
    const month = now.getMonth() + 1;
    const today = now.getDate();
    
    document.getElementById("rangeInfo").innerText = 
      `Showing records from 1/${month}/${year} to ${today}/${month}/${year}`;
    
    const startDate = new Date(`${year}-${month}-01`);
    const endDate = new Date(`${year}-${month}-${today}`);
    
    const tbody = document.querySelector("#dataTable tbody");
    const summaryBody = document.querySelector("#summaryTable tbody");
    tbody.innerHTML = "";
    summaryBody.innerHTML = "";
    
    const teacherCounts = {};

    for (let i = 1; i < rows.length; i++) {
      const dateStr = rows[i][0].trim();
      const teacher = rows[i][1]?.trim() || "";
      if (!dateStr || !teacher) continue;

      const [day, mon, yr] = dateStr.split("/").map(Number);
      const dateObj = new Date(yr, mon - 1, day);

      if (dateObj >= startDate && dateObj <= endDate) {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${dateStr}</td><td>${teacher}</td>`;
        tbody.appendChild(tr);

        teacherCounts[teacher] = (teacherCounts[teacher] || 0) + 1;
      }
    }

    if (Object.keys(teacherCounts).length === 0) {
      tbody.innerHTML = `<tr><td colspan="2">No data found for this month yet.</td></tr>`;
      summaryBody.innerHTML = `<tr><td colspan="2">No teacher summary yet.</td></tr>`;
    } else {
      Object.entries(teacherCounts).forEach(([name, count]) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${name}</td><td>${count}</td>`;
        summaryBody.appendChild(tr);
      });
    }

  } catch (err) {
    document.getElementById("rangeInfo").innerText = "⚠️ Failed to load sheet.";
    console.error(err);
  }
}

loadCSV();
</script>
</body>
</html>
